---
layout:     post
title:      "TCP的三次握手和四次挥手"
subtitle:   "详解TCP协议是如何建立连接和如何断开连接的"
date:       2016-07-25
author:     "MAI HAO"
header-img: "img/post-bg-js-module.jpg"
tags:
    - TCP/IP
---

## TCP的总流程

TCP的整个会话可以总结成三大过程

  1. 建立连接

     * 在TCP中发送数据前必须先建立连接

     * 非对称的连接建立：客户机发起，服务器响应

  2. 数据传输

     * 在TCP中保证数据的可靠传输

     * 全双工，对称的数据传输：双方都可以收发数据

  3. 释放连接

     * 会话结束后需要将连接释放

     * 对称的连接释放：双方都可以发起释放连接的请求

### TCP的三次握手

TCP的三次握手的主要目的是：客户机和服务器互相确认对方的身份；确认当前链路的完整性（确认客户机和服务器都存在而且可达；确认客户机和服务器对应的端口允许连接的建立）；协商数据传输过程的相关信息（主要协商序列号和发送窗口大小）

下图为三次握手的流程：
![TCP1](/img/TCP_hand_shake/tcp_hand_shake.jpg)

> 由图中可以看到，第一次是客户端给服务器发送SYN请求，请求建立连接，并附上一个随机的序列号；服务器回复对应序列号的ACK,同时再随机产生一个序列号**跟之前的那个没有任何联系**；最后客户端回复对应序列号的ACK.

### TCP的四次挥手

在TCP中有两种释放连接的方法

1. 强制释放
某一方发出一个将RST位设为1的TCP段，并立刻释放，接收方收到后无论处于什么状态也会立刻释放

2. 协商释放
这个就用到四次挥手了

下图为四次挥手的流程：
![TCP2](/img/TCP_hand_shake/tcp_hand_shake2.jpg)

> 由图中可以看到，首先客户端发送FIN请求并附上随机序列号，服务端根据序列号回应ACK,接着服务端再发送FIN请求附上随机序列号，客户端根据序列号回应ACK.
